<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Grub Lane - Table Reservations</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|DM+Serif+Display:400,400i&amp;display=swap"
      rel="stylesheet"
    />
    <link rel="shortcut icon" href="ftco-32x32.html" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/magnific-popup.css" />
    <link rel="stylesheet" href="fonts/ionicons/css/ionicons.min.css" />
    <link rel="stylesheet" href="fonts/fontawesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />
    <link rel="stylesheet" href="css/reservation.css" />

    <!-- Favicon -->
    <link rel="icon" href="img/favicon.png" type="image/png" />
    <link rel="shortcut icon" href="img/favicon-icon" type="image/png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- HEADER -->
    <header role="banner">
      <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <div class="container">
          <a class="navbar-brand" href="index.html"
            ><img
              src="img/GrublaneBC-03.png"
              alt="grublane logo"
              style="width: 200px"
          /></a>
          <div class="d-flex">
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarsExample05"
              aria-controls="navbarsExample05"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <a class="nav-link" href="#" id="cart-button"
              ><i class="fa fa-shopping-cart"></i
            ></a>
          </div>
          <div class="collapse navbar-collapse" id="navbarsExample05">
            <ul class="navbar-nav ml-auto pl-lg-5 pl-0">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="about.html">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="dine-in.html">Dine-In Menu</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="take-out.html">Take-Out Menu</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="reservation.html"
                  >Table Reservations</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contact.html">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- RESERVATION SECTION -->
    <section class="banner">
      <div class="card-container">
        <div class="card-img">
          <!-- img here -->
        </div>

        <div class="card-content">
          <h3>Reservation</h3>
          <form id="createReservationForm">
            <div class="form-row">
              <input
                type="date"
                placeholder="Select Date"
                name="reservation-date"
                id="date"
                required
              />

              <select name="hours" id="time" required>
                <option value="" disabled selected>Select Time</option>
                <option value="10">10:00</option>
                <option value="11">11:00</option>
                <option value="12">12:00</option>
                <option value="13">13:00</option>
                <option value="14">14:00</option>
                <option value="15">15:00</option>
                <option value="16">16:00</option>
                <option value="17">17:00</option>
                <option value="18">18:00</option>
                <option value="19">19:00</option>
                <option value="20">20:00</option>
                <option value="21">21:00</option>
                <option value="22">22:00</option>
              </select>
            </div>

            <div class="form-row">
              <input type="text" id="name" placeholder="Full Name" required />
              <input
                type="text"
                id="phone_number"
                placeholder="Phone Number"
                required
              />
            </div>

            <div class="form-row">
              <input
                type="email"
                id="email"
                placeholder="Email Address"
                name="email"
                required
              />
            </div>

            <div class="form-row">
              <input
                type="number"
                id="number_of_guests"
                placeholder="Number of Guests"
                min="1"
                required
              />

              <!-- <select id="table_number" required>
                <option value="" disabled selected>Select Table</option>
              </select> -->
              <input
                type="number"
                id="table_number"
                placeholder="Table Number"
                required
              />
              <input type="submit" value="BOOK TABLE" />
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- SIDE CART -->
    <div id="side-cart" class="side-cart">
      <div class="side-cart-header">
        Your Cart
        <span id="side-cart-close" class="side-cart-close">&times;</span>
      </div>
      <div id="side-cart-items" class="side-cart-items">
        <!-- Cart items will be inserted here by JavaScript -->
      </div>
      <div class="side-cart-footer">
        <h3 id="total-price">Total: N0</h3>
        <button id="checkout-button">Checkout with Paystack</button>
      </div>
    </div>

    <!-- OVERLAY -->
    <div id="overlay" class="overlay"></div>

    <!-- JavaScript Dependencies -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/magnific-popup-options.js"></script>
    <script src="js/main.js"></script>
    <script src="js/cart.js"></script>

    <!-- SCRIPT FOR RESERVATION DATE -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dateInput = document.getElementById("date");
        const today = new Date();

        const formatDate = (date) => {
          let day = ("0" + date.getDate()).slice(-2);
          let month = ("0" + (date.getMonth() + 1)).slice(-2);
          return `${date.getFullYear()}-${month}-${day}`;
        };

        dateInput.min = formatDate(today);

        // Placeholder-like effect
        const placeholderText = "Select Date";
        const placeholderLabel = document.createElement("label");
        placeholderLabel.textContent = placeholderText;
        placeholderLabel.classList.add("placeholder-label");

        // Append the label right before the input
        dateInput.parentNode.insertBefore(placeholderLabel, dateInput);

        const togglePlaceholder = () => {
          if (dateInput.value) {
            placeholderLabel.style.display = "none";
          } else {
            placeholderLabel.style.display = "inline";
          }
        };

        dateInput.addEventListener("input", togglePlaceholder);

        // Initialize placeholder visibility
        togglePlaceholder();
      });
    </script>
    <!-- END OF RESERVATION DATE SCRIPT -->

    <!-- FORM SUBMISSION POST REQUEST -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("createReservationForm")
          .addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent default form submission

            // Collect user data
            const name = document.getElementById("name").value;
            const phoneNumber = document.getElementById("phone_number").value;
            const email = document.getElementById("email").value;

            // Collect reservation data
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const numberOfGuests =
              document.getElementById("number_of_guests").value;

            // Define the API endpoint for creating a user
            const userEndpointUrl = "https://grublanerestaurant.com/api/users";

            // Create the user first
            fetch(userEndpointUrl, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                name: name,
                phone_number: phoneNumber,
                email: email,
              }),
            })
              .then((response) => {
                if (response.status === 409) {
                  throw new Error("User already exists with this email.");
                }
                if (!response.ok) {
                  throw new Error("Failed to create user.");
                }
                return response.json();
              })
              .then((userData) => {
                // Now that the user is created, use the user_id to create the reservation
                const userId = userData.id;
                const reservationEndpointUrl =
                  "https://grublanerestaurant.com/api/reservations";

                return fetch(reservationEndpointUrl, {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    user_id: userId,
                    date_time: `${date} ${time}`, // Combine date and time
                    number_of_guests: numberOfGuests,
                  }),
                });
              })
              .then((response) => {
                if (!response.ok) {
                  return response.json().then((errorData) => {
                    console.error("Error response:", errorData);
                    throw new Error(
                      `Failed to create reservation. Status: ${response.status}`
                    );
                  });
                }
                return response.json();
              })
              .then((reservationData) => {
                console.log(
                  "Reservation created successfully with ID:",
                  reservationData.id
                );
                alert("Reservation created successfully!");
              })
              .catch((error) => {
                console.error("Error:", error.message);
                alert("Error: " + error.message);
              });
          });
      });
    </script>

    <!-- SCRIPT FOR FETCHING TABLES -->
    <!-- <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dateInput = document.getElementById("date");
        const timeInput = document.getElementById("time");
        const tableSelect = document.getElementById("table_number");

        function fetchAvailableTables(date, time) {
          const dateTime = `${date} ${time}`;
          const availableTablesEndpointUrl = `https://grublanerestaurant.com/api/reservations/available-tables?date_time=${encodeURIComponent(
            dateTime
          )}`;

          fetch(availableTablesEndpointUrl)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Failed to fetch available tables.");
              }
              return response.json();
            })
            .then((data) => {
              const availableTables = data.available_tables;
              tableSelect.innerHTML = ""; // Clear the previous options
              availableTables.forEach((table) => {
                const option = document.createElement("option");
                option.value = table.table_number;
                option.textContent = `Table ${table.table_number}`;
                tableSelect.appendChild(option);
              });
            })
            .catch((error) => {
              console.error("Error:", error.message);
              alert("Error: " + error.message);
            });
        }

        // Trigger fetchAvailableTables when date or time changes
        dateInput.addEventListener("change", () => {
          if (dateInput.value && timeInput.value) {
            fetchAvailableTables(dateInput.value, timeInput.value);
          }
        });

        timeInput.addEventListener("change", () => {
          if (dateInput.value && timeInput.value) {
            fetchAvailableTables(dateInput.value, timeInput.value);
          }
        });
      });
    </script> -->

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-23581568-13");
    </script>
  </body>
</html>
